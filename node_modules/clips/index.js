var koa = require('koa');
var kRouter = require('koa-router');
var routers = require('./lib/router');
var bodyParser = require('koa-bodyparser');
var accesslog = require('koa-accesslog');
var mount = require('koa-mount');
var Grant = require('grant-koa');
var grant = new Grant(require('./config/oauth.json'));
var session = require('koa-session');
var app = koa();

app.use(function *(next) {
  var start = new Date;

  yield next;
  var ms = new Date - start;
  this.set('X-Response-Time', ms + 'ms');
});

app.use(bodyParser());
app.use(accesslog());
app.use(routers);

// REQUIRED:
app.keys = ['grant'];
app.use(session(app));

// mount grant
app.use(mount(grant));

app.listen(8787);
